{
  "version": 3,
  "tables": [
    {
      "table": {
        "schema": "public",
        "name": "chats"
      },
      "object_relationships": [
        {
          "name": "messages",
          "using": {
            "foreign_key_constraint_on": {
              "column": "chat_id",
              "table": {
                "schema": "public",
                "name": "messages"
              }
            }
          }
        }
      ],
      "select_permissions": [
        {
          "role": "user",
          "permission": {
            "columns": "*",
            "filter": {
              "id": {
                "_in": {
                  "messages": {
                    "chat_id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  }
                }
              }
            }
          }
        }
      ],
      "insert_permissions": [
        {
          "role": "user",
          "permission": {
            "columns": "*"
          }
        }
      ],
      "update_permissions": [
        {
          "role": "user",
          "permission": {
            "columns": "*",
            "filter": {
              "id": {
                "_in": {
                  "messages": {
                    "chat_id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  }
                }
              }
            }
          }
        }
      ],
      "delete_permissions": [
        {
          "role": "user",
          "permission": {
            "filter": {
              "id": {
                "_in": {
                  "messages": {
                    "chat_id": {
                      "_eq": "X-Hasura-User-Id"
                    }
                  }
                }
              }
            }
          }
        }
      ]
    },
    {
      "table": {
        "schema": "public",
        "name": "messages"
      },
      "object_relationships": [
        {
          "name": "chat",
          "using": {
            "foreign_key_constraint_on": "chat_id"
          }
        }
      ],
      "select_permissions": [
        {
          "role": "user",
          "permission": {
            "columns": "*",
            "filter": {
              "chat_id": {
                "messages": {
                  "chat_id": {
                    "_eq": "X-Hasura-User-Id"
                  }
                }
              }
            }
          }
        }
      ],
      "insert_permissions": [
        {
          "role": "user",
          "permission": {
            "columns": "*",
            "check": {
              "chat_id": {
                "messages": {
                  "chat_id": {
                    "_eq": "X-Hasura-User-Id"
                  }
                }
              }
            }
          }
        }
      ],
      "update_permissions": [
        {
          "role": "user",
          "permission": {
            "columns": "*",
            "filter": {
              "chat_id": {
                "messages": {
                  "chat_id": {
                    "_eq": "X-Hasura-User-Id"
                  }
                }
              }
            }
          }
        }
      ],
      "delete_permissions": [
        {
          "role": "user",
          "permission": {
            "filter": {
              "chat_id": {
                "messages": {
                  "chat_id": {
                    "_eq": "X-Hasura-User-Id"
                  }
                }
              }
            }
          }
        }
      ]
    }
  ],
  "actions": [
    {
      "name": "sendMessage",
      "definition": {
        "arguments": [
          {
            "name": "chatId",
            "type": "uuid"
          },
          {
            "name": "message",
            "type": "String"
          }
        ],
        "handler": "https://your-n8n-webhook-url.com",
        "type": "mutation",
        "forward_client_headers": true,
        "headers": [
          {
            "name": "Authorization",
            "value": "Bearer YOUR_N8N_WEBHOOK_SECRET"
          }
        ]
      },
      "permissions": [
        {
          "role": "user",
          "permission": {
            "require_auth": true,
            "check": {
              "chatId": {
                "messages": {
                  "chat_id": {
                    "_eq": "X-Hasura-User-Id"
                  }
                }
              }
            }
          }
        }
      ]
    }
  ]
}
